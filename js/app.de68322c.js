(function(){var e={8261:function(e,l,t){"use strict";var o=t(5130),s=t(6768),n=t(4232),r=t(144),i=(t(4114),t(8490)),c=t(2721);const a={},u=(0,i.v)(c.Q,a);class d{constructor(){if(d.instance)return d.instance;this.rows=[],this.numOfRows=(0,r.KR)(50),this.numOfCols=(0,r.KR)(50),this.selRow=0,this.selCol=0,this.prevRow=0,this.prevCol=0,this.copyBuffer=[[]],this.path=null;for(let e=0;e<this.numOfRows.value;e++){let e=[];for(let l=0;l<this.numOfCols.value;l++)e.push("");this.rows.push(e)}d.instance=this}getFormula(e,l){try{return this.rows[e][l]}catch(t){return console.log(t.message),""}}getValue(e,l){let t=this.getFormula(e,l);if("="!==t[0])return t;t=t.substring(1),t=t.replaceAll("THISROW",e),t=t.replaceAll("THISCOL",l),t=t.replaceAll("PREVROW",e-1),t=t.replaceAll("PREVCOL",l-1),console.log(e-1),t=t.replaceAll(/\{([^}]+)\}/g,((e,l)=>{try{const e=u.evaluate(l);return e}catch(t){return console.error(`Error evaluating expression "${l}":`,t),e}})),t=t.replace(/\b([A-Z]+\d+):([A-Z]+\d+)\b/g,((e,l,t)=>{const o=l.match(/[A-Z]+/)[0].charCodeAt(0)-65,s=parseInt(l.match(/\d+/)[0]),n=t.match(/[A-Z]+/)[0].charCodeAt(0)-65,r=parseInt(t.match(/\d+/)[0]);let i=0,c="",a=0;for(let d=s;d<=r;d++)for(let e=o;e<=n;e++){a++;try{i+=Number(this.getValue(d,e)),c+=this.getValue(d,e),c+=","}catch{i+=0,c+="'"+this.getValue(d,e)+"',"}}let u=i/a;return c=c.substring(0,c.length-1),c="["+c+"]",JSON.stringify({SUM:i,ARRAY:JSON.parse(c),COUNT:a,AVG:u})})),t=t.replace(/SUM\((.*)\)/g,((e,l)=>JSON.parse(l).SUM)),t=t.replace(/COUNT\((.*)\)/g,((e,l)=>JSON.parse(l).COUNT)),t=t.replace(/AVG\((.*)\)/g,((e,l)=>JSON.parse(l).AVG)),t=t.replace(/MEAN\((.*)\)/g,((e,l)=>JSON.parse(l).AVG)),t=t.replace(/([A-Z])(\d+)/g,((e,l,t)=>this.getValue(t,l.charCodeAt(0)-65)));try{return u.evaluate(t)}catch(o){return o.message}}selectCell(e,l){try{this.selRow=e,this.selCol=l;let t=document.getElementById("formulaBar");t.value=this.getFormula(e,l),void 0!==this.getSelectedCell()&&(this.getSelectedCell().className="cell"),document.getElementById("cellPicker").value=String.fromCharCode(l+65)+e,this.getCell(e,l).className="focussed cell",this.updateRelRows();let o=l;this.selCol<this.prevCol&&(o=l>1?l-1:0);let s=e;this.selRow>this.prevRow?s=e<this.numOfRows.value-1?e+1:this.numOfRows.value:this.selRow<this.prevRow&&(s=e>2?e-2:0),this.getCell(s,o).scrollIntoView({block:"nearest",inline:"nearest"});let n=!1,r=window.scrollX,i=window.scrollY;0==l&&(r=0,n=!0),e==this.numOfRows.value-1&&(i=document.body.scrollHeight,n=!0),e<2&&(i=0,n=!0),n&&window.scrollTo({left:r,top:i}),this.prevRow=this.selRow,this.prevCol=this.selCol}catch(t){console.log(t.message)}this.clearPlaceholder()}scrollToCenterSelCell(){let e=this.getCell(this.selRow,this.selCol);e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}setFormula(){this.rows[this.selRow][this.selCol]=document.getElementById("formulaBar").value,this.getCell(this.selRow,this.selCol).innerText=this.getValue(this.selRow,this.selCol),this.loadAllCells()}yank(e){this.copyBuffer=e}paste(e){for(let l=0;l<e;l++){for(let e=0;e<this.copyBuffer.length;e++)for(let l=0;l<this.copyBuffer[e].length;l++)this.rows[this.selRow+e][this.selCol+l]=this.copyBuffer[e][l];this.loadAllCells(),this.moveDown(1)}}getCell(e,l){return document.getElementById(l+":"+e)}getSelectedCell(){return document.getElementsByClassName("focussed")[0]}moveLeft(e){for(let l=0;l<e;l++)this.selCol>0&&this.selectCell(this.selRow,this.selCol-1);this.updateRelRows()}moveRight(e){for(let l=0;l<e;l++)this.selCol<this.numOfCols.value-1&&this.selectCell(this.selRow,this.selCol+1)}moveUp(e){for(let l=0;l<e;l++)this.selRow>0&&this.selectCell(this.selRow-1,this.selCol)}moveDown(e){for(let l=0;l<e;l++)this.selRow<this.numOfRows.value-1&&this.selectCell(this.selRow+1,this.selCol)}updateRelRows(){let e=document.getElementsByClassName("relRow");for(let l=1;l<e.length;l++)e[l].innerText=Math.abs(this.selRow-l)}saveSheetToClipboard(){let e=JSON.stringify(this.rows);navigator.clipboard.writeText(e)}loadFromClipboard(){let e=document.getElementById("commandLine"),l=e.value;if(""===l)return void(e.placeholder="Paste the JSON string here, then click 'Load from clipboard'");console.log(l);let t=JSON.parse(l);this.rows=t,this.loadAllCells(),e.value="",this.clearPlaceholder()}clearPlaceholder(){let e=document.getElementById("commandLine");e.placeholder=""}setPlaceholder(e){let l=document.getElementById("commandLine");l.placeholder=e}loadAllCells(){for(let e=0;e<this.numOfRows.value;e++)for(let l=0;l<this.numOfCols.value;l++)try{this.getCell(e,l).innerText=this.getValue(e,l)}catch{console.log("cell not yet loaded")}this.clearPlaceholder()}removeColAtIndex(e){console.log("index: "+e);for(let l=0;l<this.rows.length;l++)console.log("deleting cols"),this.rows[l].splice(e,1);this.loadAllCells(),this.selectCell(this.selRow,this.selCol)}deleteSelCol(e){for(let l=0;l<e;l++)this.removeColAtIndex(this.selCol)}removeRowAtIndex(e){this.rows.splice(e,1),this.loadAllCells()}deleteSelRow(e){for(let l=0;l<e;l++)this.removeRowAtIndex(this.selRow)}insertRowAtIndex(e){let l=[];for(let t=0;t<this.numOfCols.value;t++)l.push("");this.rows.splice(e,0,l),this.numOfRows.value++,this.loadAllCells(),this.selectCell(this.selRow,this.selCol)}insertColumnAtIndex(e){for(let l=0;l<this.numOfRows.value;l++)this.rows[l].splice(e,0,"");this.numOfCols.value++,this.loadAllCells(),this.selectCell(this.selRow,this.selCol)}insertRowBelow(){this.insertRowAtIndex(this.selRow+1),this.moveDown(1)}insertRowAbove(){this.insertRowAtIndex(this.selRow)}insertColRight(){this.insertColumnAtIndex(this.selCol+1),this.moveRight(1)}insertColLeft(){this.insertColumnAtIndex(this.selCol)}}const h={class:"tableCell"},m=["id"];var f={__name:"SheetCell",props:{rowNo:{type:Number,required:!0},colNo:{type:Number,required:!0}},setup(e){const l=(0,r.KR)(new d);function t(){l.value.selectCell(n.rowNo,n.colNo)}function o(){l.value.selectCell(n.rowNo,n.colNo),document.getElementById("formulaBar").focus()}const n=e;return(l,n)=>((0,s.uX)(),(0,s.CE)("td",h,[(0,s.Lk)("button",{id:e.colNo+":"+e.rowNo,class:"cell",onDblclick:o,onClick:n[0]||(n[0]=e=>t())},null,40,m)]))}},w=t(1241);const p=(0,w.A)(f,[["__scopeId","data-v-2af3181c"]]);var C=p;const v={class:"sheetRow"},g={class:"labels rowLabels"},R={class:"labels relRow"};var y={__name:"SheetRow",props:{rowNo:{type:Number,required:!0},row:{type:Array,required:!0}},setup(e){return(l,t)=>((0,s.uX)(),(0,s.CE)("tr",v,[(0,s.Lk)("td",g,(0,n.v_)(e.rowNo),1),(0,s.Lk)("td",R,(0,n.v_)(e.rowNo),1),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.row,((l,t)=>((0,s.uX)(),(0,s.Wv)(C,{key:t,rowNo:e.rowNo,colNo:t},null,8,["rowNo","colNo"])))),128))]))}};const b=y;var O=b;const I={id:"topBar"};var A={__name:"FormulaBar",setup(e){const l=new d;function t(){l.setFormula(),document.getElementById("commandLine").focus()}function n(){document.getElementById("commandLine").focus()}function r(){let e=document.getElementById("cellPicker").value,t=e.charCodeAt(0)-65,o=parseInt(e.slice(1));const s=/^[A-Z]\d+$/;s.test(e)&&l.selectCell(o,t)}function i(){document.getElementById("formulaBar").focus()}return(e,l)=>((0,s.uX)(),(0,s.CE)("div",I,[(0,s.Lk)("input",{id:"cellPicker",onInput:r,onKeyup:[(0,o.jR)(n,["esc"]),(0,o.jR)(i,["enter"])],type:"text",placeholder:"e.g. A0"},null,32),(0,s.Lk)("input",{id:"formulaBar",type:"text",placeholder:"edit cell formulae",onKeyup:[(0,o.jR)(t,["enter"]),(0,o.jR)(n,["esc"])]},null,32)]))}};const L=(0,w.A)(A,[["__scopeId","data-v-7bcc78f4"]]);var k=L;t(4603),t(7566),t(8721);const B={id:"webFileUpload"};var E={__name:"CommandLine",setup(e){const l=new d;async function t(e=!1){console.log(e),n(JSON.stringify(l.rows),"sheet.dflo")}function n(e,l){const t=new Blob([e],{type:"text/plain"}),o=URL.createObjectURL(t),s=document.createElement("a");s.href=o,s.download=l,s.click(),URL.revokeObjectURL(o)}function r(){document.getElementById("webFileUpload").style.display="none"}async function i(){document.getElementById("webFileUpload").style.display="block"}function c(){const e=document.getElementById("fileInput"),t=e.files[0];console.log("web view");const o=new FileReader;o.onload=function(e){console.log(e.target.result),l.rows=JSON.parse(e.target.result),l.numOfRows.value=l.rows.length,l.numOfCols.value=l.rows[0].length,l.loadAllCells()},o.readAsText(t),document.getElementById("webFileUpload").style.display="none"}function a(){let e=document.getElementById("commandLine").value;":w"==e?(t(),document.getElementById("commandLine").value=""):":wa"==e?(t(!0),document.getElementById("commandLine").value=""):":o"==e&&(i(),document.getElementById("commandLine").value="")}function u(){let e=document.getElementById("commandLine").value,t=document.getElementById("formulaBar"),o=document.getElementById("cellPicker"),s=!1;if("i"==e)t.focus(),s=!0;else if("I"==e)l.selectCell(l.selRow,0),t.focus(),s=!0;else if("^"==e)l.selectCell(l.selRow,0),s=!0;else if("$"==e)l.selectCell(l.selRow,l.numOfCols.value-1),s=!0;else if("c"==e)t.value="",t.focus(),l.setFormula(),s=!0;else if(";"==e)o.focus(),o.value="",s=!0;else if("zz"==e)l.scrollToCenterSelCell(),s=!0;else if("oj"==e)l.insertRowBelow(),s=!0;else if("ok"==e)l.insertRowAbove(),s=!0;else if("oh"==e)l.insertColLeft(),s=!0;else if("ol"==e)l.insertColRight(),s=!0;else if("yf"==e){let e=l.selCol,t=l.selRow,o=l.getFormula(t,e);navigator.clipboard.writeText(o),l.yank([[o]]),s=!0}else if("ys"==e){let e=l.selCol,t=l.selRow,o=l.getValue(t,e);navigator.clipboard.writeText(o),l.yank([[o]]),s=!0}let n=h(e).amount,r=h(e).command;"h"==r?(l.moveLeft(n),s=!0):"j"==r?(l.moveDown(n),s=!0):"k"==r?(l.moveUp(n),s=!0):"l"==r?(l.moveRight(n),s=!0):"p"==r?(l.paste(n),s=!0):"dd"==r?(l.deleteSelRow(n),s=!0):"dc"==r&&(l.deleteSelCol(n),s=!0),s&&(document.getElementById("commandLine").value="")}function h(e){const l=e.match(/^(\d+)?(.+)$/);if(!l)return null;const[t,o,s]=l;return console.log(t),{amount:o?parseInt(o,10):1,command:s}}return(e,l)=>((0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("input",{id:"commandLine",spellcheck:"false",type:"text",onInput:u,onKeyup:(0,o.jR)(a,["enter"])},null,32),(0,s.Lk)("div",B,[l[2]||(l[2]=(0,s.Lk)("input",{id:"fileInput",type:"file"},null,-1)),(0,s.Lk)("button",{id:"readFileBtn",onClick:l[0]||(l[0]=e=>c())},"Read File"),(0,s.Lk)("button",{id:"cancelButton",onClick:l[1]||(l[1]=e=>r())},"Cancel")])],64))}};const N=E;var S=N,x={__name:"App",setup(e){const l=(0,r.KR)(new d);return(e,t)=>((0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(k),(0,s.bF)(S),(0,s.Lk)("table",null,[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[t[0]||(t[0]=(0,s.Lk)("th",{class:"rowLabelType rowLabels"},"abs",-1)),t[1]||(t[1]=(0,s.Lk)("th",{class:"rowLabelType relRow"},"rel",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.value.numOfRows,((e,l)=>((0,s.uX)(),(0,s.CE)("th",{key:l,class:"labels colLabels"},(0,n.v_)(String.fromCharCode(l+65)),1)))),128))])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.value.rows,((e,l)=>((0,s.uX)(),(0,s.Wv)(O,{key:l,row:e,rowNo:l},null,8,["row","rowNo"])))),128))])])],64))}};const F=x;var T=F;const _=(0,o.Ef)(T);_.mount("#app")},1234:function(){}},l={};function t(o){var s=l[o];if(void 0!==s)return s.exports;var n=l[o]={id:o,loaded:!1,exports:{}};return e[o].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}t.m=e,function(){t.amdD=function(){throw new Error("define cannot be used indirect")}}(),function(){t.amdO={}}(),function(){var e=[];t.O=function(l,o,s,n){if(!o){var r=1/0;for(u=0;u<e.length;u++){o=e[u][0],s=e[u][1],n=e[u][2];for(var i=!0,c=0;c<o.length;c++)(!1&n||r>=n)&&Object.keys(t.O).every((function(e){return t.O[e](o[c])}))?o.splice(c--,1):(i=!1,n<r&&(r=n));if(i){e.splice(u--,1);var a=s();void 0!==a&&(l=a)}}return l}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[o,s,n]}}(),function(){t.n=function(e){var l=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(l,{a:l}),l}}(),function(){t.d=function(e,l){for(var o in l)t.o(l,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:l[o]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,l){return Object.prototype.hasOwnProperty.call(e,l)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};t.O.j=function(l){return 0===e[l]};var l=function(l,o){var s,n,r=o[0],i=o[1],c=o[2],a=0;if(r.some((function(l){return 0!==e[l]}))){for(s in i)t.o(i,s)&&(t.m[s]=i[s]);if(c)var u=c(t)}for(l&&l(o);a<r.length;a++)n=r[a],t.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return t.O(u)},o=self["webpackChunkdataflow"]=self["webpackChunkdataflow"]||[];o.forEach(l.bind(null,0)),o.push=l.bind(null,o.push.bind(o))}();var o=t.O(void 0,[504],(function(){return t(8261)}));o=t.O(o)})();
//# sourceMappingURL=app.de68322c.js.map